<template>
  <c-spinner-utils visible={showSpinner} size="large"></c-spinner-utils>
  <div class="card-style" style="width: 100%">
    <lightning-card
      class="slds-align_absolute-center"
      icon-name="standard:user"
      title="Complete an unfinished deposit account application, or check your application status."
      variant="narrow"
    >
      <div class="slds-grid slds-wrap slds-var-m-around_small">
        <div class="slds-col slds-size_1-of-2 slds-var-p-around_small">
          <lightning-input
            required
            label="Last Name"
            data-fieldname="mflow__LastName__c"
            placeholder="Enter your last name"
            pattern={alphanumValidation}
            message-when-pattern-mismatch={alphanumValidationMessage}
            field-level-help="Enter your last name"
            maxlength="20"
            value={applicantData.mflow__LastName__c}
            onchange={handleChange}
            class="validation slds-form-element__static"
          ></lightning-input>
        </div>

        <div class="slds-col slds-size_1-of-2 slds-var-p-around_small">
          <lightning-input
            required
            label="Last 4 digits of SSN"
            data-fieldname="mflow__LastFourDigitsofSSN__c"
            placeholder="Enter Last 4 digits of your SSN"
            maxlength="4"
            value={applicantData.mflow__LastFourDigitsofSSN__c}
            onchange={handleChange}
            class="validation slds-form-element__static"
          ></lightning-input>
        </div>

        <div class="slds-col slds-size_1-of-2 slds-var-p-around_small">
          <lightning-input
            required
            label="Email"
            data-fieldname="mflow__Email__c"
            type="Email"
            placeholder="example@company.com"
            value={applicantData.mflow__Email__c}
            onchange={handleChange}
            class="validation slds-form-element__static"
          ></lightning-input>
        </div>
      </div>
      <div class="slds-var-p-around_medium" style="text-align: end">
        <lightning-button
          variant="brand"
          label="Submit"
          title="Submit"
          onclick={handleSubmit}
          class="slds-var-m-around_small card-footer-right-btn"
          icon-name="utility:save"
          icon-position="left"
        ></lightning-button>
        <lightning-button
          variant="brand"
          label="Clear"
          title="Clear"
          onclick={handleCancel}
          class="slds-var-m-around_small card-footer-right-btn"
          icon-name="utility:close"
          icon-position="right"
        ></lightning-button>
      </div>
      <hr />
      <template if:true={applications}>
        <div class="slds-form-element__static lgc-bg slds-align_absolute-center">
          Search Results: {applicationCount} applications found.
        </div>
        <div class="slds-p-around_small">
          <lightning-accordion class="slds-var-p-around_small">
            <template for:each={applications} for:item="app">
              <lightning-accordion-section name={app.Name} label={app.Name} key={app.Id}>
                <div class="slds-grid slds-wrap">
                  <div class="slds-col">
                    <lightning-formatted-text value="Application Status :" class="slds-form-element__label">
                    </lightning-formatted-text>
                    <p class="slds-truncate slds-form-element__static" title={app.mflow__Status__c}>
                      {app.mflow__Status__c}
                    </p>
                  </div>
                  <div class="slds-col slds-var-p-around_small">
                    <lightning-formatted-text
                      value="Created Date :"
                      class="slds-form-element__label"
                    ></lightning-formatted-text>
                    <p class="slds-truncate slds-form-element__static">{app.CreatedDate}</p>
                  </div>
                </div>

                <table class="styled-table">
                  <thead>
                    <tr>
                      <th>Applicant Name</th>
                      <th>Applicant Type</th>
                      <th>Email</th>
                      <th>Status</th>
                      <th>Action</th>
                    </tr>
                  </thead>
                  <template for:each={app.mflow__Applicants__r} for:item="applicant">
                    <tbody key={applicant.id}>
                      <tr class="active-row">
                        <td>{applicant.mflow__ApplicantName__c}</td>
                        <td>{applicant.mflow__ApplicantType__c}</td>
                        <td>{applicant.mflow__Email__c}</td>
                        <td>{applicant.mflow__Status__c}</td>
                        <td>
                          <lightning-button
                            data-fieldname={applicant.Id}
                            variant="brand"
                            label="Resume"
                            title="Resume"
                            onclick={handleResume}
                            class="slds-var-p-around_small card-footer-right-btn"
                          ></lightning-button>
                        </td>
                      </tr>
                    </tbody>
                  </template>
                </table>
              </lightning-accordion-section>
            </template>
          </lightning-accordion>
        </div>
      </template>
    </lightning-card>
  </div>
</template>
